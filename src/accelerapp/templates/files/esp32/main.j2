// Auto-generated ESP32 firmware
// Device: {{ device_name }}
// Generated by: Accelerapp Platform

#include <Arduino.h>
{% if wifi_enabled %}
#include <WiFi.h>
{% endif %}
#include "config.h"

{% if wifi_enabled %}
const char* ssid = "{{ wifi_ssid | default('YOUR_SSID') }}";
const char* password = "{{ wifi_password | default('YOUR_PASSWORD') }}";
{% endif %}

void setup() {
    // Initialize serial communication
    Serial.begin({{ baud_rate | default(115200) }});
    Serial.println("{{ device_name }} starting...");
    
    {% if wifi_enabled %}
    // Connect to WiFi
    WiFi.begin(ssid, password);
    Serial.print("Connecting to WiFi");
    while (WiFi.status() != WL_CONNECTED) {
        delay(500);
        Serial.print(".");
    }
    Serial.println("\nWiFi connected");
    Serial.print("IP address: ");
    Serial.println(WiFi.localIP());
    {% endif %}
    
    {% for peripheral in peripherals %}
    // Initialize {{ peripheral.type }} on pin {{ peripheral.pin }}
    {% if peripheral.type == 'led' %}
    pinMode({{ peripheral.pin }}, OUTPUT);
    {% elif peripheral.type == 'button' %}
    pinMode({{ peripheral.pin }}, INPUT_PULLUP);
    {% elif peripheral.type == 'sensor' %}
    pinMode({{ peripheral.pin }}, INPUT);
    {% elif peripheral.type == 'camera' %}
    // Camera initialization would go here
    Serial.println("Camera module detected");
    {% endif %}
    {% endfor %}
}

void loop() {
    {% for peripheral in peripherals %}
    {% if peripheral.type == 'sensor' %}
    // Read sensor on pin {{ peripheral.pin }}
    int {{ peripheral.type }}_value = analogRead({{ peripheral.pin }});
    Serial.print("Sensor: ");
    Serial.println({{ peripheral.type }}_value);
    {% elif peripheral.type == 'led' %}
    // Blink LED on pin {{ peripheral.pin }}
    digitalWrite({{ peripheral.pin }}, HIGH);
    delay(500);
    digitalWrite({{ peripheral.pin }}, LOW);
    delay(500);
    {% endif %}
    {% endfor %}
    
    delay(100);
}
